<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <title>Painel Administrativo | SabApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- AdminLTE + Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
  /* MAPA */
  #mapAngola { 
    height: 350px; 
    border-radius: 10px;
  }

/* ===============================
   OVERLAY LISTA DE ALUNOS
================================ */

.alunos-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.55);

  display: none;
  justify-content: center;
  align-items: center;

  z-index: 9999;
}

/* ===============================
   BLOCO DE LISTAGEM DE ALUNOS
================================ */

.alunos-container {
  width: 90%;
  max-width: 1150px;
  max-height: 85vh;
  overflow-y: auto;

  background: #ffffff;
  border-radius: 14px;
  padding: 22px;

  box-shadow: 0 15px 40px rgba(0,0,0,0.25);

  animation: zoomIn .25s ease;
  transition: all .3s ease;
}

@keyframes zoomIn {
  from {
    transform: scale(.9);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.dark-mode .alunos-container {
  background: #1f2d3d;
}

/* ===============================
   T√çTULO
================================ */

.alunos-title {
  font-size: 1.4rem;
  font-weight: 600;
  margin-bottom: 15px;
}

/* ===============================
   TABELA
================================ */

table.tabela-alunos {
  width: 100%;
  border-collapse: collapse;
}

table.tabela-alunos thead {
  background: linear-gradient(45deg,#007bff,#0056b3);
  color: white;
}

table.tabela-alunos th,
table.tabela-alunos td {
  padding: 11px;
  border-bottom: 1px solid #e1e1e1;
  vertical-align: middle;
}

.dark-mode table.tabela-alunos th,
.dark-mode table.tabela-alunos td {
  border-color: #3b3b3b;
}

table.tabela-alunos tbody tr:hover {
  background: rgba(0,123,255,0.08);
}

.dark-mode table.tabela-alunos tbody tr:hover {
  background: rgba(255,255,255,0.06);
}

/* ===============================
   STATUS VISUAL
================================ */

.status-online {
  color: #28a745;
  font-weight: bold;
}

.status-offline {
  color: #dc3545;
  font-weight: bold;
}

.status-vinculado {
  background: #28a745;
  color: white;
  padding: 4px 9px;
  border-radius: 8px;
  font-size: 12px;
}

.status-nao-vinculado {
  background: #dc3545;
  color: white;
  padding: 4px 9px;
  border-radius: 8px;
  font-size: 12px;
}

/* ===============================
   BOT√ïES
================================ */

.btn-remover {
  background: #dc3545;
  color: white;
  border: none;
  padding: 5px 12px;
  border-radius: 7px;
  cursor: pointer;
  transition: .2s;
}

.btn-remover:hover {
  opacity: .8;
}

/* ===============================
   LOADING
================================ */

.loader-alunos {
  text-align: center;
  padding: 25px;
  font-weight: bold;
  font-size: 15px;
  color: #007bff;
}

/* ===============================
   RESPONSIVO
================================ */

@media (max-width: 768px) {

  .alunos-container {
    width: 95%;
    max-height: 90vh;
    padding: 15px;
  }

  table.tabela-alunos thead {
    display: none;
  }

  table.tabela-alunos tr {
    display: block;
    margin-bottom: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 5px;
  }

  .dark-mode table.tabela-alunos tr {
    border-color: #444;
  }

  table.tabela-alunos td {
    display: flex;
    justify-content: space-between;
    padding: 8px;
  }

  table.tabela-alunos td::before {
    content: attr(data-label);
    font-weight: 600;
  }
}

/* ===============================
   OVERLAY ALUNOS DISPON√çVEIS
================================ */

.alunos-disponiveis-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.55);

  display: none;
  justify-content: center;
  align-items: center;

  z-index: 9999;
}

/* ===============================
   CONTAINER
================================ */

.alunos-disponiveis-container {
  width: 90%;
  max-width: 1050px;
  max-height: 85vh;
  overflow-y: auto;

  background: #ffffff;
  border-radius: 14px;
  padding: 22px;

  box-shadow: 0 15px 40px rgba(0,0,0,0.25);

  animation: zoomIn .25s ease;
}

.dark-mode .alunos-disponiveis-container {
  background: #1f2d3d;
}

/* ===============================
   TABELA
================================ */

table.tabela-disponiveis {
  width: 100%;
  border-collapse: collapse;
}

table.tabela-disponiveis thead {
  background: linear-gradient(45deg,#17a2b8,#0f6674);
  color: white;
}

table.tabela-disponiveis th,
table.tabela-disponiveis td {
  padding: 11px;
  border-bottom: 1px solid #e1e1e1;
}

.dark-mode table.tabela-disponiveis th,
.dark-mode table.tabela-disponiveis td {
  border-color: #3b3b3b;
}

table.tabela-disponiveis tbody tr:hover {
  background: rgba(23,162,184,0.12);
}

/* ===============================
   STATUS
================================ */

.status-disponivel {
  color: #17a2b8;
  font-weight: bold;
}

/* ===============================
   LOADING
================================ */

.loader-disponiveis {
  text-align: center;
  padding: 25px;
  font-weight: bold;
  font-size: 15px;
  color: #17a2b8;
}

/* ===============================
   MENU PROFESSORES ONLINE
================================ */

.nav-treeview .nav-link.prof-online-btn {
  border-left: 3px solid transparent;
  transition: .2s;
}

.nav-treeview .nav-link.prof-online-btn:hover {
  background: rgba(0,123,255,.08);
  border-left-color: #007bff;
}

.dark-mode .nav-treeview .nav-link.prof-online-btn:hover {
  background: rgba(255,255,255,.05);
}

/* ===============================
   OVERLAY PROFESSORES
================================ */

.professores-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

/* ===============================
   CONTAINER
================================ */

.professores-container {
  background: white;
  border-radius: 14px;
  padding: 20px;
  width: 95%;
  max-width: 900px;
  max-height: 80vh;          /* limita altura */
  box-shadow: 0 10px 40px rgba(0,0,0,.25);
  position: relative;
  display: flex;
  flex-direction: column;
}

.dark-mode .professores-container {
  background: #1f2d3d;
}

/* ===============================
   BOT√ïES SCROLL
================================ */

.scroll-btn {
  position: absolute;
  right: 10px;
  width: 35px;
  height: 35px;
  border: none;
  border-radius: 50%;
  background: rgba(0,123,255,0.8);
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  transition: .2s;
  z-index: 10;
}

.scroll-btn:hover {
  background: #007bff;
}

.scroll-up {
  top: 10px;
}

.scroll-down {
  bottom: 10px;
}

/* ===============================
   TABELA ‚Äì PAGAMENTOS ALUNOS
================================ */

table.tabela-professores {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

table.tabela-professores thead {
  background: linear-gradient(45deg,#17a2b8,#117a8b);
  color: #fff;
}

table.tabela-professores th,
table.tabela-professores td {
  padding: 12px;
  border-bottom: 1px solid #e1e1e1;
  text-align: left;
  vertical-align: middle;
}

.dark-mode table.tabela-professores th,
.dark-mode table.tabela-professores td {
  border-color: #444;
}

/* ===============================
   STATUS
================================ */

.prof-online {
  color: #28a745;
  font-weight: bold;
}

.prof-offline {
  color: #dc3545;
  font-weight: bold;
}

/* ===============================
   BOT√ÉO PAGO
================================ */

.btn-prof-remover {
  background: #dc3545;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
}

.btn-prof-remover:hover {
  opacity: .85;
}

/* ===============================
   OVERLAY (CORRE√á√ÉO DO SCROLL)
================================ */

.professores-overlay {
  position: fixed;
  inset: 0;
  display: none;
  align-items: flex-start;     
  justify-content: center;
  background: rgba(0,0,0,.55);
  overflow-y: auto;             
  padding: 40px 0;              
  z-index: 9999;
}

/* ===============================
   CONTAINER INTERNO
================================ */

.professores-container {
  background: #fff;
  width: 90%;
  max-width: 1100px;
  max-height: none;            
  border-radius: 14px;
  padding: 20px;
  display: flex;
  flex-direction: column;
}

.dark-mode .professores-container {
  background: #1f2d3d;
}

/* ===============================
   SCROLL APENAS NA LISTA (OPCIONAL)
================================ */

.tabela-scroll {
  max-height: 65vh;             
  overflow-y: auto;
  overflow-x: hidden;
  scroll-behavior: smooth;
  padding-right: 6px;
}

.tabela-scroll::-webkit-scrollbar {
  width: 6px;
}

.tabela-scroll::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,.25);
  border-radius: 6px;
}

.dark-mode .tabela-scroll::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,.25);
}

/* ===============================
   MOBILE (‚â§ 768px)
================================ */

@media (max-width: 768px) {

  table.tabela-professores thead {
    display: none;
  }

  table.tabela-professores tbody tr {
    display: block;
    margin-bottom: 14px;
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 12px;
    background: #fff;
  }

  .dark-mode table.tabela-professores tbody tr {
    background: #1f2d3d;
    border-color: #444;
  }

  table.tabela-professores tbody td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 6px;
    border: none;
    font-size: 14px;
  }

  table.tabela-professores tbody td::before {
    content: attr(data-label);
    font-weight: 600;
    color: #555;
  }

  .dark-mode table.tabela-professores tbody td::before {
    color: #bbb;
  }

  table.tabela-professores tbody td:last-child {
    flex-direction: column;
    gap: 6px;
  }

  table.tabela-professores tbody td:last-child button {
    width: 100%;
  }

  .professores-container {
    width: 96%;
    padding: 14px;
  }
}

/* ===============================
   MOBILE (‚â§ 768px)
================================ */

@media (max-width: 768px) {

  table.tabela-professores thead {
    display: none;
  }

  table.tabela-professores tbody tr {
    display: block;
    margin-bottom: 14px;
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 12px;
    background: #fff;
  }

  .dark-mode table.tabela-professores tbody tr {
    background: #1f2d3d;
    border-color: #444;
  }

  table.tabela-professores tbody td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 6px;
    border: none;
    font-size: 14px;
  }

  table.tabela-professores tbody td::before {
    content: attr(data-label);
    font-weight: 600;
    color: #555;
  }

  .dark-mode table.tabela-professores tbody td::before {
    color: #bbb;
  }

  table.tabela-professores tbody td:last-child {
    flex-direction: column;
    gap: 6px;
  }

  table.tabela-professores tbody td:last-child button {
    width: 100%;
  }

  
  .professores-container {
    width: 96%;
    max-height: 92vh;
    padding: 14px;
  }
}
    
/* ===============================
   MOBILE (‚â§ 768px)
   MESMO COMPORTAMENTO DA TABELA MODERNA
================================ */

@media (max-width: 768px) {

  /* Remove header */
  table.tabela-professores thead {
    display: none;
  }

  /* Cada linha vira um card */
  table.tabela-professores tbody tr {
    display: block;
    margin-bottom: 14px;
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 12px;
    background: #fff;
  }

  .dark-mode table.tabela-professores tbody tr {
    background: #1f2d3d;
    border-color: #444;
  }

  /* C√©lulas em coluna */
  table.tabela-professores tbody td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 6px;
    border: none;
    font-size: 14px;
  }

  table.tabela-professores tbody td::before {
    content: attr(data-label);
    font-weight: 600;
    color: #555;
  }

  .dark-mode table.tabela-professores tbody td::before {
    color: #bbb;
  }

  /* A√ß√µes (bot√µes) */
  table.tabela-professores tbody td:last-child {
    flex-direction: column;
    gap: 6px;
  }

  table.tabela-professores tbody td:last-child button {
    width: 100%;
    border-radius: 8px;
  }
}

/* ===============================
   RESPONSIVO
================================ */

@media(max-width:768px){

  table.tabela-professores thead{display:none}

  table.tabela-professores tr{
    display:block;
    margin-bottom:10px;
    border:1px solid #ddd;
    border-radius:8px;
    padding:6px;
  }

  table.tabela-professores td{
    display:flex;
    justify-content:space-between;
  }

  table.tabela-professores td::before{
    content:attr(data-label);
    font-weight:600;
  }
}

/* =================================
   TABELAS ‚Äì PADR√ÉO GERAL
================================= */

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

table thead {
  position: sticky;
  top: 0;
  z-index: 2;
}

table th,
table td {
  padding: 10px 12px;
  border-bottom: 1px solid #e1e1e1;
  vertical-align: middle;
}

.dark-mode table th,
.dark-mode table td {
  border-color: #444;
}

/* =================================
   STATUS
================================= */

.status-circulo {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 6px;
}

.status-verde {
  background: #28a745;
  color: #28a745;
  font-weight: bold;
}

.status-vermelho {
  background: #dc3545;
  color: #dc3545;
  font-weight: bold;
}

/* =================================
   BOT√ïES (MOBILE FRIENDLY)
================================= */

table button {
  min-width: 80px;
  padding: 6px 10px;
  font-size: 13px;
  cursor: pointer;
}

@media (max-width: 768px) {

  /* ===============================
     REMOVE HEADER
  ============================== */
  table thead {
    display: none;
  }

  /* ===============================
     CARD POR LINHA
  ============================== */
  table tbody tr {
    display: block;
    margin-bottom: 14px;
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 10px;
    background: #fff;
  }

  .dark-mode table tbody tr {
    background: #1f2d3d;
    border-color: #444;
  }

  /* ===============================
     C√âLULAS EM COLUNA
  ============================== */
  table tbody td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 6px;
    border: none;
    font-size: 14px;
  }

  table tbody td::before {
    content: attr(data-label);
    font-weight: 600;
    color: #555;
  }

  .dark-mode table tbody td::before {
    color: #bbb;
  }

  /* ===============================
     BOT√ïES EM LINHA / COLUNA
  ============================== */
  table tbody td:last-child {
    flex-direction: column;
    gap: 6px;
  }

  table tbody td:last-child button {
    width: 100%;
    border-radius: 8px;
  }
}

/* =================================
   T√çTULOS DENTRO DOS MODAIS
================================= */

.alunos-title,
.professores-title {
  font-size: 1.3rem;
  font-weight: 600;
  margin-bottom: 12px;
}

/* =================================
   CONTAINERS ‚Äì MOBILE
================================= */

@media (max-width: 768px) {

  .alunos-container,
  .professores-container {
    width: 96%;
    max-height: 92vh;
    padding: 14px;
    border-radius: 14px;
  }
}

/* =================================
   SCROLL SUAVE EM MOBILE
================================= */

table tbody {
  scroll-behavior: smooth;
}

/* ===============================
   WRAPPER
================================ */
.tabela-wrapper {
  background: #fff;
  border-radius: 14px;
  padding: 20px;
  max-height: 85vh;
  overflow-y: auto;
}

.dark-mode .tabela-wrapper {
  background: #1f2d3d;
}

/* ===============================
   T√çTULO
================================ */
.modal-title {
  font-size: 1.3rem;
  font-weight: 600;
  margin-bottom: 15px;
}

/* ===============================
   TABELA DESKTOP
================================ */
.tabela-pagamentos {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

.tabela-pagamentos thead {
  background: linear-gradient(45deg, #007bff, #0056b3);
  color: #fff;
}

.tabela-pagamentos th,
.tabela-pagamentos td {
  padding: 12px;
  border-bottom: 1px solid #e1e1e1;
  text-align: left;
}

.dark-mode .tabela-pagamentos th,
.dark-mode .tabela-pagamentos td {
  border-color: #444;
}

.tabela-pagamentos tbody tr:hover {
  background: rgba(0,123,255,.08);
}

/* ===============================
   STATUS
================================ */
.status {
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.status-pago {
  background: #28a745;
  color: #fff;
}

.status-pendente {
  background: #dc3545;
  color: #fff;
}

/* ===============================
   BOT√ïES
================================ */
.btn {
  border: none;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
}

.btn-danger {
  background: #dc3545;
  color: #fff;
}

.btn-danger:hover {
  opacity: .85;
}

/* ===============================
   MOBILE (‚â§ 768px)
================================ */
@media (max-width: 768px) {

  .tabela-pagamentos thead {
    display: none;
  }

  .tabela-pagamentos tbody tr {
    display: block;
    margin-bottom: 14px;
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 12px;
    background: #fff;
  }

  .dark-mode .tabela-pagamentos tbody tr {
    background: #1f2d3d;
    border-color: #444;
  }

  .tabela-pagamentos tbody td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 4px;
    border: none;
  }

  .tabela-pagamentos tbody td::before {
    content: attr(data-label);
    font-weight: 600;
    color: #555;
  }

  .dark-mode .tabela-pagamentos tbody td::before {
    color: #bbb;
  }

  .tabela-pagamentos tbody td:last-child {
    flex-direction: column;
    gap: 6px;
  }

  .tabela-pagamentos tbody td:last-child button {
    width: 100%;
  }
}
    
</style>


</head>

<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu"><i class="fas fa-bars"></i></a>
      </li>
    </ul>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" onclick="toggleDarkMode()"><i class="fas fa-moon"></i></a>
      </li>
    </ul>
  </nav>

  <!-- Sidebar -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">

    <a href="#" class="brand-link text-center">
      <span class="brand-text font-weight-light">Administra√ß√£o SabApp</span>
    </a>

    <!-- ===============================
         MENU
    ================================== -->
    <div class="sidebar">
      <nav class="mt-3">
        <ul class="nav nav-pills nav-sidebar flex-column"
            data-widget="treeview" role="menu" data-accordion="false">

          <!-- MENU ALUNOS -->
          <li class="nav-item has-treeview">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-user-graduate"></i>
              <p>Alunos <i class="right fas fa-angle-left"></i></p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="#" class="nav-link" onclick="event.preventDefault(); carregarAlunos();">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Alunos Cadastrados</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link" onclick="event.preventDefault(); carregarAlunosDisponiveis();">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Alunos sem v√≠nculo</p>
                </a>
              </li>
            </ul>
          </li>

          <!-- MENU PROFESSORES -->
          <li class="nav-item has-treeview">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-chalkboard-teacher"></i>
              <p>Professores <i class="right fas fa-angle-left"></i></p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="#" class="nav-link" onclick="event.preventDefault(); carregarProfessores();">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Professores Online</p>
                </a>
              </li>
            </ul>
          </li>

          <!-- MENU FINAN√áAS -->
          <li class="nav-item has-treeview">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-coins"></i>
              <p>Finan√ßas <i class="right fas fa-angle-left"></i></p>
            </a>
            <ul class="nav nav-treeview">
             <li class="nav-item">
               <a href="#" class="nav-link" onclick="event.preventDefault(); abrirFinanceAlunos();">
                 <i class="far fa-circle nav-icon"></i>
                 <p>Pagamentos Alunos</p>
               </a>
            </li>

         <li class="nav-item">
           <a href="#" class="nav-link"
              onclick="event.preventDefault(); abrirFinanceProf();">
             <i class="far fa-circle nav-icon"></i>
             <p>Paga. Professores</p>
           </a>
        </li>

<!-- ===============================
     OVERLAY FINAN√áAS PROFESSORES
================================ -->
<div class="professores-overlay" id="overlayFinanceProf">
  <div class="professores-container tabela-wrapper">

    <div class="modal-header">
      <h3 class="modal-title">üí∞ Pagamentos ‚Äì Professores</h3>
      <button class="btn btn-secondary" onclick="fecharFinanceProf()">Fechar</button>
    </div>

    <table class="tabela-pagamentos" id="tabela-pagamentos-prof">
      <thead>
        <tr>
          <th>Professor</th>
          <th>Status</th>
          <th>Saldo Atual</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <!-- JS injeta linhas aqui -->
      </tbody>
    </table>

  </div>
</div>
<!-- ===============================
     DETALHES PAGAMENTOS PROFESSOR
================================ -->
<div class="professores-overlay" id="detalhes-prof">
  <div class="professores-container tabela-wrapper">

    <div class="modal-header">
      <div>
        <h3 class="modal-title" id="nome-prof">Professor</h3>
        <small>
          Saldo atual:
          <strong id="saldo-prof">0 Kz</strong>
        </small>
      </div>
      <button class="btn btn-secondary" onclick="fecharDetalhesProf()">Fechar</button>
    </div>

    <table class="tabela-pagamentos">
      <thead>
        <tr>
          <th>M√™s</th>
          <th>Data</th>
          <th>Valor</th>
          <th>Email</th>
          <th>Status</th>
          <th>A√ß√£o</th>
        </tr>
      </thead>
      <tbody id="tabela-meses">
        <!-- JS injeta linhas aqui -->
      </tbody>
    </table>

  </div>
</div>


  </div>
</div>

          <div class="professores-overlay" id="overlayFinanceAlunos">
  <div class="professores-container">

    <div style="display:flex;justify-content:space-between;align-items:center">
      <h4>üí∞ Pagamentos de Alunos</h4>
      <button class="btn btn-secondary" onclick="fecharFinanceAlunos()">Fechar</button>
    </div>

    <table class="tabela-professores" id="tabela-pagamentos">
      <thead>
        <tr>
          <th>Aluno</th>
          <th>Status</th>
          <th>D√≠vida</th>
          <th>√öltimo Pagamento</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

  </div>
</div>

<div class="professores-overlay" id="detalhes-aluno">
  <div class="professores-container">

    <div style="display:flex;justify-content:space-between;align-items:center">
      <h4 id="nome-aluno">üìå Pagamentos</h4>
      <button class="btn btn-secondary" onclick="fecharDetalhesAluno()">Fechar</button>
    </div>

    <table class="tabela-professores">
      <thead>
        <tr>
          <th>M√™s</th>
          <th>Ano</th>
          <th>Valor</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tabela-meses"></tbody>
    </table>

  </div>
</div>          
          
        </ul>
      </nav>
    </div>
  </aside>

  <!-- ===============================
       OVERLAYS (TODOS MANTIDOS)
  ================================== -->
  <!-- ALUNOS -->
  <div class="alunos-overlay" id="overlayAlunos">
    <div class="alunos-container">
      <div style="display:flex;justify-content:space-between">
        <div class="alunos-title">üìã Alunos Cadastrados</div>
        <button class="btn btn-secondary" onclick="fecharAlunos()">Fechar</button>
      </div>
      <table class="tabela-alunos" id="tabela-alunos">
        <thead>
          <tr>
            <th>Nome</th><th>Disciplina</th><th>Online</th><th>V√≠nculo</th><th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- ALUNOS SEM V√çNCULO -->
  <div class="alunos-disponiveis-overlay" id="overlayDisponiveis">
    <div class="alunos-disponiveis-container">
      <div style="display:flex;justify-content:space-between">
        <div class="alunos-title">üë§ Alunos sem v√≠nculo</div>
        <button class="btn btn-secondary" onclick="fecharAlunosDisponiveis()">Fechar</button>
      </div>
      <table class="tabela-disponiveis" id="tabela-disponiveis">
        <thead>
          <tr>
            <th>Nome</th><th>Disciplina</th><th>Bairro</th><th>Prov√≠ncia</th><th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- PROFESSORES -->
  <div class="professores-overlay" id="overlayProfessores">
    <div class="professores-container">
      <div style="display:flex;justify-content:space-between">
        <div class="alunos-title">üë®‚Äçüè´ Professores Online</div>
        <button class="btn btn-secondary" onclick="fecharProfessores()">Fechar</button>
      </div>
      <table class="tabela-professores" id="tabela-professores">
        <thead>
          <tr>
            <th>Email</th><th>Nome</th><th>Status</th><th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

 <!-- Conte√∫do -->
  <div class="content-wrapper">
    <section class="content pt-3">
      <div class="container-fluid">

        <!-- CARDS -->
        <div class="row">

          <div class="col-lg-3 col-6">
            <div class="small-box bg-info">
              <div class="inner">
                <h3 id="total-alunos">0</h3>
                <p>Alunos</p>
              </div>
              <div class="icon"><i class="fas fa-user-graduate"></i></div>
            </div>
          </div>

          <div class="col-lg-3 col-6">
            <div class="small-box bg-success">
              <div class="inner">
                <h3 id="total-professores">0</h3>
                <p>Professores</p>
              </div>
              <div class="icon"><i class="fas fa-chalkboard-teacher"></i></div>
            </div>
          </div>

          <div class="col-lg-3 col-6">
            <div class="small-box bg-warning">
              <div class="inner">
                <h3 id="chamadas-ativas">0</h3>
                <p>Aulas Ativas</p>
              </div>
              <div class="icon"><i class="fas fa-video"></i></div>
            </div>
          </div>

          <div class="col-lg-3 col-6">
            <div class="small-box bg-danger">
              <div class="inner">
                <h3 id="alunos-nao-vinculados">0</h3>
                <p>Alunos N√£o Vinculados</p>
              </div>
              <div class="icon"><i class="fas fa-unlink"></i></div>
            </div>
          </div>

        </div>

        <!-- GR√ÅFICO + MAPA -->
        <div class="row">

          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Resumo Geral</h3>
              </div>
              <div class="card-body">
                <canvas id="grafico"></canvas>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Mapa de Angola</h3>
              </div>
              <div class="card-body">
                <div id="mapAngola"></div>
              </div>
            </div>
          </div>

        </div>

      </div>
    </section>
  </div>

  <footer class="main-footer text-center">
    <strong>Todos os Direitos reservados √† SabApp 2026</strong>
  </footer>

</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
function toggleDarkMode() {
  document.body.classList.toggle("dark-mode");
}

// üìä BUSCAR ESTAT√çSTICAS
fetch("/estatisticas-dashboard")
  .then(res => res.json())
  .then(dados => {

    document.getElementById("total-alunos").innerText = dados.alunos.total;
    document.getElementById("total-professores").innerText = dados.professores.total;
    document.getElementById("chamadas-ativas").innerText = dados.chamadas.em_andamento;
    document.getElementById("alunos-nao-vinculados").innerText = dados.alunos.nao_vinculados;

    new Chart(document.getElementById("grafico"), {
      type: "doughnut",
      data: {
        labels: [
          "Alunos Online",
          "Alunos Offline",
          "Vinculados",
          "N√£o Vinculados"
        ],
        datasets: [{
          data: [
            dados.alunos.online,
            dados.alunos.offline,
            dados.alunos.vinculados,
            dados.alunos.nao_vinculados
          ]
        }]
      }
    });
  });

// üó∫Ô∏è MAPA
const map = L.map('mapAngola').setView([-11.2027, 17.8739], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
L.marker([-8.839, 13.289]).addTo(map).bindPopup("Luanda");

async function carregarAlunos() {

  const overlay = document.getElementById("overlayAlunos");
  const tbody = document.querySelector("#tabela-alunos tbody");

  if (!overlay || !tbody) {
    console.error("Overlay ou tabela n√£o encontrados");
    return;
  }

  // abre modal
  overlay.style.display = "flex";

  // loading inicial
  tbody.innerHTML = `
    <tr>
      <td colspan="5" class="loader-alunos">
        Carregando alunos...
      </td>
    </tr>
  `;

  try {

    const res = await fetch("/listar-alunos");

    if (!res.ok) {
      tbody.innerHTML = `
        <tr>
          <td colspan="5" class="loader-alunos" style="color:red">
            Erro ao buscar alunos
          </td>
        </tr>
      `;
      return;
    }

    let alunos = await res.json();

    // ‚úÖ FILTRA NOMES VAZIOS / NULL
    alunos = alunos.filter(a =>
      a &&
      a.nome &&
      a.nome.toString().trim() !== ""
    );

    tbody.innerHTML = "";

    if (!alunos.length) {
      tbody.innerHTML = `
        <tr>
          <td colspan="5" style="text-align:center;font-weight:bold">
            Nenhum aluno v√°lido encontrado
          </td>
        </tr>
      `;
      return;
    }

    alunos.forEach(a => {

      const nome = a.nome?.toString().trim() || "‚Äî";
      const disciplina = a.disciplina || "‚Äî";

      tbody.innerHTML += `
        <tr>
          <td data-label="Nome">${nome}</td>
          <td data-label="Disciplina">${disciplina}</td>

          <td data-label="Status"
              class="${a.online ? 'status-online' : 'status-offline'}">
            ${a.online ? "Online" : "Offline"}
          </td>

          <td data-label="Vinculado">
            <span class="${a.vinculado ? 'status-vinculado' : 'status-nao-vinculado'}">
              ${a.vinculado ? "Sim" : "N√£o"}
            </span>
          </td>

          <td data-label="A√ß√µes">
            <button class="btn-remover"
              onclick="removerAluno('${nome}')">
              Remover
            </button>
          </td>
        </tr>
      `;
    });

  } catch (err) {

    console.error("Erro JS:", err);

    tbody.innerHTML = `
      <tr>
        <td colspan="5" class="loader-alunos" style="color:red">
          Erro inesperado
        </td>
      </tr>
    `;
  }

}
function fecharAlunos() {
  const overlay = document.getElementById("overlayAlunos");

  if (overlay) {
    overlay.style.display = "none";
  }
}
  
  async function carregarAlunosDisponiveis() {

  const overlay = document.getElementById("overlayDisponiveis");
  const tbody = document.querySelector("#tabela-disponiveis tbody");

  if (!overlay || !tbody) {
    console.error("Overlay ou tabela dispon√≠veis n√£o encontrados");
    return;
  }

  overlay.style.display = "flex";

  tbody.innerHTML = `
    <tr>
      <td colspan="5" class="loader-disponiveis">
        Carregando alunos...
      </td>
    </tr>
  `;

  try {

    const res = await fetch("/alunos-nao-vinculados");

    if (!res.ok) {
      tbody.innerHTML = `
        <tr>
          <td colspan="5" class="loader-disponiveis" style="color:red">
            Erro ao buscar alunos
          </td>
        </tr>
      `;
      return;
    }

    let alunos = await res.json();

    // filtra nomes vazios
    alunos = alunos.filter(a =>
      a.nome && a.nome.toString().trim() !== ""
    );

    tbody.innerHTML = "";

    if (!alunos.length) {
      tbody.innerHTML = `
        <tr>
          <td colspan="5" style="text-align:center;font-weight:bold">
            Nenhum aluno dispon√≠vel
          </td>
        </tr>
      `;
      return;
    }

    alunos.forEach(a => {

      tbody.innerHTML += `
        <tr>
          <td>${a.nome}</td>
          <td>${a.disciplina || "‚Äî"}</td>
          <td>${a.bairro || "‚Äî"}</td>
          <td>${a.provincia || "‚Äî"}</td>
          <td class="status-disponivel">
            ${a.online ? "Online" : "Offline"}
          </td>
        </tr>
      `;
    });

  } catch (err) {

    console.error("Erro JS:", err);

    tbody.innerHTML = `
      <tr>
        <td colspan="5" class="loader-disponiveis" style="color:red">
          Erro inesperado
        </td>
      </tr>
    `;
  }
}
  
function fecharAlunosDisponiveis() {

  const overlay = document.getElementById("overlayDisponiveis");
  const tbody = document.querySelector("#tabela-disponiveis tbody");

  // fecha o overlay
  if (overlay) {
    overlay.style.display = "none";
  }

  // limpa tabela
  if (tbody) {
    tbody.innerHTML = "";
  }
}

async function carregarProfessores() {

  const overlay = document.getElementById("overlayProfessores");
  const tbody = document.querySelector("#tabela-professores tbody");
  const select = document.getElementById("lista-professores");

  if (!overlay || !tbody) {
    console.error("Overlay professores n√£o encontrado");
    return;
  }

  overlay.style.display = "flex";

  tbody.innerHTML = `
    <tr>
      <td colspan="4" class="loader-alunos">
        Carregando professores...
      </td>
    </tr>
  `;

  try {

    const res = await fetch("/listar-professores-online");

    if (!res.ok) throw new Error();

    const profs = await res.json();

    tbody.innerHTML = "";

    if (!profs.length) {
      tbody.innerHTML = `
        <tr>
          <td colspan="4" style="text-align:center;font-weight:bold">
            Nenhum professor online
          </td>
        </tr>
      `;
      return;
    }

    if (select) {
      select.innerHTML = `
        <option disabled selected>Selecione o professor</option>
        <option value="todos">Todos os Professores</option>
      `;
    }

    profs.forEach(p => {

      tbody.innerHTML += `
        <tr>

          <td data-label="Email">${p.email}</td>

          <td data-label="Nome">${p.nome}</td>

          <td data-label="Status"
              class="${p.online ? 'prof-online' : 'prof-offline'}">
            ${p.online ? "Online" : "Offline"}
          </td>

          <td data-label="A√ß√µes">
            <button class="btn-prof-remover"
              onclick="removerProfessor('${p.email}')">
              Remover
            </button>
          </td>

        </tr>
      `;

      if (select && p.email) {
        select.innerHTML += `<option value="${p.email}">${p.email}</option>`;
      }

    });

  } catch (err) {

    tbody.innerHTML = `
      <tr>
        <td colspan="4" class="loader-alunos" style="color:red">
          Erro ao carregar professores
        </td>
      </tr>
    `;

  }

}
  
function fecharProfessores() {

  const overlay = document.getElementById("overlayProfessores");
  const tbody = document.querySelector("#tabela-professores tbody");

  if (overlay) overlay.style.display = "none";

  if (tbody) tbody.innerHTML = "";
}

 async function marcarPago(alunoId, temDivida) {

  if (!temDivida) {
    alert("Este aluno j√° est√° com o pagamento em dia.");
    return;
  }

  const res = await fetch("/listar-pagamentos");
  const alunos = await res.json();

  const aluno = alunos.find(a => a.id === alunoId && a.nome);

  if (!aluno) {
    alert("Aluno n√£o encontrado.");
    return;
  }

  const hoje = new Date();
  const mes = hoje.getMonth() + 1;
  const ano = hoje.getFullYear();

  const resposta = await fetch("/api/registrar-pagamento", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      aluno_nome: aluno.nome,
      mes,
      ano,
      valor_pago: aluno.valor_mensal_aluno || 0,
      pago: true
    })
  });

  if (resposta.ok) {
    alert("Pagamento registrado com sucesso!");
    carregarPagamentos();
  } else {
    alert("Erro ao registrar pagamento.");
  }
}

async function carregarPagamentos() {

  const res = await fetch("/listar-pagamentos");
  const alunos = await res.json();
  const tbody = document.querySelector("#tabela-pagamentos tbody");

  tbody.innerHTML = "";

  alunos.forEach(a => {

    if (!a.nome) return;

    const temDivida = a.divida && Number(a.divida) > 0;
    const statusTexto = temDivida ? "N√£o Pago" : "Pago";
    const statusCor = temDivida ? "prof-offline" : "prof-online";

    let ultimoPagamento = "‚Äî";
    if (a.paga_passado?.length) {
      const u = a.paga_passado[a.paga_passado.length - 1];
      ultimoPagamento = `${u.mes}/${u.ano} - Kz ${Number(u.valor_pago).toLocaleString("pt-AO")},00`;
    }

    tbody.innerHTML += `
      <tr>
        <td>${a.nome}</td>
        <td class="${statusCor}">${statusTexto}</td>
        <td>Kz ${Number(a.divida || 0).toLocaleString("pt-AO")},00</td>
        <td>${ultimoPagamento}</td>
        <td>
          <button class="btn-prof-remover"
            onclick="marcarPago('${a.id}', ${temDivida})">
            PAGO
          </button>

          <button class="btn btn-info btn-sm"
            onclick="verPagamentos('${a.nome}', '${a.nome}')">
            Ver
          </button>
        </td>
      </tr>
    `;
  });
}

  async function verPagamentos(nomeAluno, nomeExibicao) {

  const res = await fetch(`/ver-pagamentos/${encodeURIComponent(nomeAluno)}`);
  const data = await res.json();

  document.getElementById("nome-aluno").innerText =
    `üìå Pagamentos de ${nomeExibicao}`;

  const tbody = document.getElementById("tabela-meses");
  tbody.innerHTML = "";

  if (!data.historico_pagamentos.length) {
    tbody.innerHTML = `<tr><td colspan="4">Nenhum pagamento encontrado</td></tr>`;
  }

  data.historico_pagamentos.forEach(p => {
    tbody.innerHTML += `
      <tr>
        <td>${p.mes}</td>
        <td>${p.ano}</td>
        <td>Kz ${Number(p.valor_pago).toLocaleString("pt-AO")},00</td>
        <td style="color:green;font-weight:bold">Pago</td>
      </tr>
    `;
  });

  document.getElementById("detalhes-aluno").style.display = "flex";
}
  
  

  function abrirFinanceAlunos() {
  document.getElementById("overlayFinanceAlunos").style.display = "flex";
  carregarPagamentos();
}

function fecharFinanceAlunos() {
  document.getElementById("overlayFinanceAlunos").style.display = "none";
}

function fecharDetalhesAluno() {
  document.getElementById("detalhes-aluno").style.display = "none";
}

/* ==============================
   ABRIR FINAN√áAS PROFESSORES
================================ */
function abrirFinanceProf() {
  const overlay = document.getElementById("overlayFinanceProf");
  overlay.style.display = "flex";

  carregarPagamentosProf();
}

/* ==============================
   LISTAR PAGAMENTOS PROFESSORES
================================ */
async function carregarPagamentosProf() {
  try {
    const res = await fetch("/listar-pagamentos-prof");
    const professores = await res.json();
    const tbody = document.querySelector("#tabela-pagamentos-prof tbody");

    tbody.innerHTML = "";

    professores.forEach(p => {

      const statusPago = Number(p.saldo_atual) <= 0;
      const statusCor = statusPago ? "status-verde" : "status-vermelho";
      const statusTexto = statusPago ? "PAGO" : "N√ÉO PAGO";

      tbody.innerHTML += `
        <tr>
          <td>${p.professor}</td>
          <td>
            <span class="status-circulo ${statusCor}"></span>
            ${statusTexto}
          </td>
          <td>${Number(p.saldo_atual).toFixed(2)} Kz</td>
          <td>
            <button
              onclick="marcarPagoProf('${p.id}', ${statusPago}, '${p.professor}', ${p.saldo_atual})"
              style="background:${statusPago ? 'green' : 'red'};color:white;border:none;padding:4px 8px;border-radius:4px;">
              ${statusTexto}
            </button>

            <button
              onclick="verMesesProf('${p.id}')"
              style="background:#007bff;color:white;border:none;padding:4px 8px;border-radius:4px;margin-left:5px;">
              Ver Meses
            </button>
          </td>
        </tr>
      `;
    });

  } catch (err) {
    console.error("Erro ao carregar pagamentos de professores:", err);
    alert("Erro ao carregar pagamentos.");
  }
}

/* ==============================
   MARCAR PAGO / N√ÉO PAGO
================================ */
async function marcarPagoProf(id, statusPago, professor, saldoAtual) {
  try {

    if (!statusPago) {
      await fetch("/registrar-pagamento-prof", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          id,
          professor,
          valor_pago: saldoAtual
        })
      });
    } else {
      await fetch("/atualizar-pagamento-prof", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          id,
          professor,
          valor_pago: 0
        })
      });
    }

    carregarPagamentosProf();

  } catch (err) {
    console.error("Erro ao atualizar pagamento do professor:", err);
    alert("Erro ao atualizar pagamento.");
  }
}

/* ==============================
   VER MESES DO PROFESSOR
================================ */
async function verMesesProf(id) {
  try {
    const res = await fetch(`/salarios?email=${encodeURIComponent(id)}`);
    const data = await res.json();

    if (!data || !data.nome) {
      alert("Professor n√£o encontrado.");
      return;
    }

    document.getElementById("nome-prof").textContent = data.nome;
    document.getElementById("saldo-prof").textContent =
      `${Number(data.saldo_atual).toFixed(2)} Kz`;

    const tbody = document.getElementById("tabela-meses");
    tbody.innerHTML = "";

    if (!data.pagamentos || !data.pagamentos.length) {
      tbody.innerHTML = `
        <tr>
          <td colspan="6" style="color:#777;">Nenhum pagamento registrado</td>
        </tr>
      `;
    }

    data.pagamentos.forEach(p => {
      const pago = Number(p.valor_pago) > 0;
      const cor = pago ? "status-verde" : "status-vermelho";
      const texto = pago ? "PAGO" : "N√ÉO PAGO";

      tbody.innerHTML += `
        <tr>
          <td>${p.mes}</td>
          <td>${p.data_pagamento || "-"}</td>
          <td>${Number(p.valor_pago).toFixed(2)} Kz</td>
          <td>${p.email_professor || "-"}</td>
          <td><span class="${cor}">${texto}</span></td>
          <td>
            <button
              onclick="marcarPagoMesProf('${id}', '${p.mes}', ${pago})"
              style="background:${pago ? 'green' : 'red'};color:white;border:none;padding:4px 8px;border-radius:4px;">
              ${texto}
            </button>
          </td>
        </tr>
      `;
    });

    document.getElementById("detalhes-prof").style.display = "flex";

  } catch (err) {
    console.error("Erro ao carregar meses do professor:", err);
    alert("Erro ao carregar detalhes.");
  }
}

/* ==============================
   FECHAR OVERLAYS
================================ */
function fecharFinanceProf() {
  document.getElementById("overlayFinanceProf").style.display = "none";
}

function fecharDetalhesProf() {
  document.getElementById("detalhes-prof").style.display = "none";
}
  
</script>

</body>
</html>



